# graph-vector数据库



## lmdb

lighting-memory-mapped-database是一个轻量级的基于b+树的：

* 嵌入式

* 有事务支持

* k-v型数据管理库



liblmdb是其软件实现，基于c语言开发，下面对其核心进行分析。

<br>

### mmap-based

数据存储基于mmap系统调用（文件映射），使得IO流程不经过系统调用，物理上具备高读写性能。基于操作系统千锤百炼的页缓存机制，基于mmap构成的数据库系统能够最大化利用操作系统的缓存算法来提升应用性能。此外，当处理的数据远大于RAM的时候，源代码中`mdb_env_set_mapsize()`函数保证了RAM中留存的是**虚拟地址空间的预留大小**。

### B+树存储

lmdb数据存储是基于b+树数据结构进行存储的，其中的基础存储单元是**页（page）**，这里存在一个关键设计：LMDB的页是一种逻辑单元，但是它的实际分配大小为运行操作系统的**物理页大小的整数倍**。

这种设计能够最大化mmap的性能：假如页大小设置为3kb（操作系统页大小是4kb），必定存在很多的页是跨页的，相应的io便是跨页io，在读操作时，这可能会使开销翻倍（读取两个内存页）。而在写操作时，整个流程需要触发：读-修改-写的全套逻辑。


